function fig = Rec(action)

sourceStr = {'MEA Square','Bundle','4 Channels'};
gainstr = {'±10V','±5V','±2.5V','±1V','±500mV','±200mV','±100mV','±50mV'};
recordingStr = {'Duration of Stimulus','Specific Time Period','Perpetually'};
tboxheight = 21;

h0 = figure('Units','points', ...
        'Color',[0.8 0.8 0.8], ...
        'Position',[1 1 1280 1024], ...
        'Name','Record Parameters', ...
        'NumberTitle','off', ...
        'HandleVisibility','Callback',...
        'Tag','RecordParamsFig');

% Display stimulator axes
h1 = axes('Parent',h0, ...
        'Units','pixels', ...
        'CameraUpVector',[0 1 0], ...
        'Color',[1 1 1], ...
        'NextPlot','replacechildren',...
        'Position',[50 710 1062 90], ...
        'Tag','StimulatorAxes', ...
        'XColor',[0 0 0], ...
        'YColor',[0 0 0], ...
        'ZColor',[0 0 0]);

% axis xy;
% xlabel('Time (s)');
% h = ylabel('Valve Number','Position',[0.0  0.4956    9.1603]);
% get(h,'Position')


% Draw frames
h1 = uicontrol('Parent',h0, ...
        'Units','points', ...
        'Position',[20 645 980 80], ...
        'Style','frame', ...
        'Tag','Frame1');

h1 = uicontrol('Parent',h0, ...
        'Units','points', ...
        'Position',[20 495 980 40], ...
        'Style','frame', ...
        'Tag','Frame2');



% Source 
h1 = uicontrol('Parent',h0, ...
        'Units','points', ...
        'Position',[68 695 120 tboxheight+1], ...
        'String',sourceStr, ...
        'Style','popupmenu', ...
        'Tag','SourceMenu', ...
        'Callback','RecCB LoadAxes',...
        'Value',1);

h1 = uicontrol('Parent',h0, ...
        'Units','points', ...
        'Position',[23 695 40 tboxheight], ...
        'Style','text', ...
        'HorizontalAlignment','right',...
        'String','Source:', ...
        'Tag','StaticText1');

% Scanrate
h1 = uicontrol('Parent',h0, ...
        'Units','points', ...
        'BackgroundColor',[1 1 1], ...
        'Position',[268 695 67 tboxheight], ...
        'Style','edit', ...
        'String','10000', ...
        'Tag','ScanRate');
h1 = uicontrol('Parent',h0, ...
        'Units','points', ...
        'Position',[208 695 55 tboxheight], ...
        'String','Scans/sec:', ...
        'HorizontalAlignment','right',...
        'Style','text', ...
        'Tag','StaticText2');

% Recording range
h1 = uicontrol('Parent',h0, ...
        'Units','points', ...
        'Position',[445 695 90 tboxheight+1], ...
        'String',gainstr, ...
        'Style','popupmenu', ...
        'Tag','RecordingRange', ...
        'Value',2);
h1 = uicontrol('Parent',h0, ...
        'Units','points', ...
        'Position',[350 695 90 tboxheight], ...
        'String','Recording range:', ...
        'HorizontalAlignment','right',...
        'Style','text', ...
        'Tag','StaticText3');

% Recording time
h1 = uicontrol('Parent',h0, ...
        'Units','points', ...
        'Position',[640 695 130 tboxheight], ...
        'String',recordingStr, ...
        'Style','popupmenu', ...
        'Callback','RecCB UpdateInfo',...
        'Tag','RecordingMenu', ...
        'Value',1);

h1 = uicontrol('Parent',h0, ...
        'Units','points', ...
        'BackgroundColor',[1 1 1], ...
        'Position',[775 695 50 tboxheight], ...
        'Style','edit', ...
        'Tag','RecordingTime', ...
        'Enable','off');

h1 = uicontrol('Parent',h0, ...
        'Units','points', ...
        'Position',[545 690 90 tboxheight+4], ...
        'String',sprintf('Recording time:\n(secs)'),...
        'HorizontalAlignment','right',...
        'Style','text', ...
        'Tag','StaticText4');
 
% Transfer Interval
h1 = uicontrol('Parent',h0, ...
        'Units','points', ...
        'BackgroundColor',[1 1 1], ...
        'Position',[935 695 50 tboxheight], ...
        'String','2', ...
        'Style','edit', ...
        'Tag','TransferInterval');

h1 = uicontrol('Parent',h0, ...
        'Units','points', ...
        'Position',[840 690 90 tboxheight+4], ...
        'String',sprintf('Transfer Interval:\n(secs)'),...
        'HorizontalAlignment','right',...
        'Style','text', ...
        'Tag','StaticText5');

% Save
h1 = uicontrol('Parent',h0, ...
        'Units','points', ...
        'Position',[68 650 90 30], ...
        'Style','checkbox',...
        'String','Save', ...
        'Callback','RecCB UpdateInfo',...
        'Value',1, ...
        'Enable','on', ...
        'Tag','Save');
    
% Save As button
h1 = uicontrol('Parent',h0, ...
        'Units','points', ...
        'BackgroundColor',[0.8 0.8 0.8], ...
        'Position',[180 650 70 30], ...
        'Style','pushbutton', ...
        'Callback','RecCB SaveAsButton',...
        'String','Save As...',...
        'Tag','SaveAs');

% Pathname/filename
h1 = uicontrol('Parent',h0, ...
        'Units','points', ...
        'Position',[272 655 200 15], ...
        'String',sprintf('File:'),...
        'HorizontalAlignment','left',...
        'Style','text', ...
        'Tag','File');

% User header
h1 = uicontrol('Parent',h0, ...
        'Units','points', ...
        'BackgroundColor',[1 1 1], ...
        'Position',[510 650 472 30], ...
        'Style','edit', ...
        'HorizontalAlignment','left',...
        'Max',2,'Min',0,...
        'String','3.16V/Pa, with additional 9x 2-pole high-pass (16.7kHz 3dB point)',...
        'Enable','on',...
        'Tag','UsrHdr');

% Stimulus File Button
h1 = uicontrol('Parent',h0, ...
        'Units','points', ...
        'Position',[900 600 100 30], ...
        'Style','pushbutton', ...
         'Callback','RecCB LoadStimFile',...
        'String','Load Stimulus File',...
        'Tag','LoadStimFile');
    
% Stim filename
h1 = uicontrol('Parent',h0, ...
        'Units','points', ...
        'Position',[900 570 100 25], ...
        'HorizontalAlignment','left',...
        'Style','text', ...
        'Tag','StimFile'); 
    
    
 

% Second frame
% Start
h1 = uicontrol('Parent',h0, ...
        'Units','points', ...
        'Position',[68 500 80 30], ...
        'Style','pushbutton', ...
        'Callback','RecCB StartButton',...
        'String','Start',...
        'Tag','Start');
 
% Stop
h1 = uicontrol('Parent',h0, ...
        'Units','points', ...
        'Position',[170 500 80 30], ...
        'Style','pushbutton', ...
        'Callback','RecCB StopButton',...
        'String','Stop',...
        'Tag','Stop');

% Display range
h1 = uicontrol('Parent',h0, ...
        'Units','points', ...
        'Position',[370 507 130 tboxheight+1], ...
        'String',gainstr, ...
        'Style','popupmenu', ...
        'Tag','DisplayRange', ...
        'Value',2);
h1 = uicontrol('Parent',h0, ...
        'Units','points', ...
        'Position',[275 507 90 tboxheight], ...
        'String','Display range:', ...
        'HorizontalAlignment','right',...
        'Style','text', ...
        'Tag','StaticText5');

% All channels
h1 = uicontrol('Parent',h0, ...
        'Units','points', ...
        'Position',[545 500 90 30], ...
        'Style','checkbox',...
        'Callback','RecCB AllChannels',...
        'String','All Channels', ...
        'Value',0, ...
        'Enable','on', ...
        'Tag','AllChannels');

% Stimulate checkbox
h1 = uicontrol('Parent',h0, ...
        'Units','points', ...
        'Position',[655 500 90 30], ...
        'Style','checkbox',...
        'Callback','RecCB UpdateInfo',...
        'String','Stimulate', ...
        'Value',1, ...
        'Enable','on', ...
        'Tag','Stimulate');
    
 % Time left
 h1 = uicontrol('Parent',h0, ...
        'Units','points', ...
        'BackgroundColor',[0.8 0.8 0.8], ...
        'Position',[775 503 157 22], ...
        'Style','text', ...
        'Tag','TimeLeftTxt');
    
 % Inactivate channels
f = uimenu('Label','Inactivate Channels','Parent',h0);
    uimenu(f,'Label','View mode','Callback','RecCB Inactivate','Accelerator','I');


RecCB('LoadAxes',h0)



